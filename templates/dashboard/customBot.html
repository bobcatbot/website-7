<!DOCTYPE html>
<html lang="en">
<head>
  {% include 'include/dash-links.html' %}

  <!-- "custom_bot": {
    "nick": "BotName",
    "token": "",
    "statuses": [
      eg in the main list
    ],
    "status": "online"
  }, -->

  <!-- @app.route("/dashboard/<int:guild_id>/custom-bot", methods=["GET", "POST"])
@login_required
async def custom_bot(guild_id):
  current_user = bearer_client().get_current_user()
  guild = bot.get_guild(guild_id)
  
  status_data = get_server_config(guild, True).get('custom_bot')

  if request.method == 'POST':
    data = request.get_json()

    if data["key"] == 'name':
      # change bot name
      async def runDiscordTask():
        await guild.me.edit(nick=data["value"])
        return
      bot.loop.create_task(runDiscordTask())
      
      # update config
      update_config(guild.id, 'custom_bot.nick', data["value"])
      return jsonify({'status': 200})

    return jsonify({'status': 200})

  return render_template("dashboard/customBot.html", user=current_user, guild=guild, data=status_data)
 -->
</head>
<body>
  <!-- ======= Header & Sidebar ======= -->
  {% include 'components/DashNavbar.html' %}
  {% include 'components/Sidebar.html' %}

  <!-- ======= svgs ======= -->
  <svg viewBox="0 0 1 1" aria-hidden="true" style="position: absolute; pointer-events: none; top: -1px; left: -1px; width: 1px; height: 1px;">
    <defs>
      <mask id="svg-mask-status-online" maskContentUnits="objectBoundingBox" viewBox="0 0 1 1"><circle fill="white" cx="0.5" cy="0.5" r="0.5"></circle></mask>
      <mask id="svg-mask-status-idle" maskContentUnits="userSpaceOnUse" x="0" y="0"><circle fill="white" cx="5" cy="5" r="5"></circle><circle fill="black" cx="2.5" cy="2.5" r="3.75"></circle></mask>
      <mask id="svg-mask-status-offline" maskContentUnits="objectBoundingBox" viewBox="0 0 1 1"><circle fill="white" cx="0.5" cy="0.5" r="0.5"></circle><circle fill="black" cx="0.5" cy="0.5" r="0.25"></circle></mask>
      <mask id="svg-mask-status-dnd" maskContentUnits="objectBoundingBox" viewBox="0 0 1 1"><circle fill="white" cx="0.5" cy="0.5" r="0.5"></circle><rect fill="black" x="0.125" y="0.375" width="0.75" height="0.25" rx="0.125" ry="0.125"></rect></mask>

      <symbol id="svg-symbol-status-online" viewBox="0 0 10 10">
        <circle fill="rgb(35, 165, 90)" mask="url(#svg-mask-status-online)" cx="5" cy="5" r="5"></circle>
      </symbol>
      <symbol id="svg-symbol-status-idle" viewBox="0 0 10 10">
        <circle fill="rgb(240, 178, 50)" mask="url(#svg-mask-status-idle)" cx="5" cy="5" r="5"></circle>
      </symbol>
      <symbol id="svg-symbol-status-offline" viewBox="0 0 10 10">
        <circle fill="gray" mask="url(#svg-mask-status-offline)" cx="5" cy="5" r="5"></circle>
      </symbol>
      <symbol id="svg-symbol-status-dnd" viewBox="0 0 10 10">
        <circle fill="red" mask="url(#svg-mask-status-dnd)" cx="5" cy="5" r="5"></circle>
      </symbol>
    </defs>
  </svg>
  
  <!-- ======= Main ======= -->
  <main id="main" class="main">
    <div class="pagetitle plugin">
      <div>
        <h1>Bot Personalizer</h1>
        <p class="m-0">Make your bot really special by changing its username, status, and activity.</p>
      </div>
    </div>

    <section class="section">
      <div class="feature_card  d-flex flex-column flex-lg-row" style="gap:2rem;">
        <div class="title avatar">
          <img id="avatar-img" src="{{guild.me.avatar.url}}" alt="" srcset="">
        </div>
        
        <div class="info d-flex flex-column w-100">
          <div class="bot-name">
            <p class="m-0">Bot name</p>
            <input type="text" id="bot-name" class="text-input" value="{{data['nick']}}">
          </div>

          <div class="bot-name">
            <p class="m-0">Bot token</p>
            <input type="text" id="bot-name" class="text-input" value="{{data['nick']}}">
          </div>
        </div>
        
        <div class="preview">
          <p class="m-0 mb-2">Your personsalalized bot</p>

          <div class="d-flex">
            <div id="avatarPreview" style="position: relative;width: 34px;height: 34px;margin-right: 12px;">
              <img id="avatar-img-preview" class="avatar-img">

              <div id="status-preview">
                <svg width="12" height="12" class="svg_afd438 mask_c7d26b icon_ad5fac" viewBox="0 0 10 10">
                  <use id="svg-symbol-status-preview" href="#svg-symbol-status-online"></use>
                </svg>
              </div>
            </div>

            <div class="data">
              <p id="username-preview" style="margin-bottom: -3px;"></p>
              <div id="bot-status-preview" class="activity m-0"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {% include 'components/PremiumModal.html' %}
    {% include 'components/save-toast.html' %}
  </main>

  <style>
    .avatar {
      width: 168px;
      height: 168px;
      padding: 1.5rem;
      background-color: #000;
      border-radius: 8px;
    }

    .avatar img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
    }

    .avatar-img {
      width: 100%;
      height: 100%;
      border-radius: 50%;

      margin-right: 12px;
    }

    #status-preview {
      position: absolute;
      bottom: 0;
      right: 0;

      height: 17px;
    }
    
    .preview {
      min-width: 313px;
      height: fit-content;
      padding: 1.25rem;
      background-color: #2E3036;
      border-radius: 8px;
    }
    
    .preview #username-preview {
      font-size: 16px;
      line-height: 20px;
      font-weight: 500;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .preview #bot-status-preview {
      font-size: 12px;

      line-height: 20px;
      font-weight: 500;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
  </style>

  <script>
    // avatar-img change
    const avatar = document.querySelector('#avatar-img');
    const avatarImg = document.querySelector('#avatar-img-preview');

    document.addEventListener('DOMContentLoaded', function () {
      avatarImg.src = avatar.src;
    });

    avatar.addEventListener('change', function (e) {
      avatarImg.src = avatar.src;
    });

    // name change
    const name = document.querySelector('#bot-name');
    const username = document.querySelector('#username-preview');

    document.addEventListener('DOMContentLoaded', function () {
      username.innerText = name.value
    });

    name.addEventListener('input', function (e) {
      var val = e.target.value; 
      username.innerText = val

      let debounceTimeout;

      clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(() => {
        fetch("custom-bot", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ "key": "name", "value": val }),
        });
      }, 600); // Adjust the delay as needed
    });
  </script>
  
</body>
</html>